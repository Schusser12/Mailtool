#Mail look-up tool -per-site-basis
mailtool() {
  output_file="~/mailtool-$(date +%m-%d-%yT%H:%M).txt"
  {
    # Get domain name
    _domain=$(sup_getdomain)

    # Define a function to check DNS records
    check_dns_records() {
    echo "Checking DNS records for domain $domain..."

         # Check for MX records
      mx_records=$(dig @8.8.8.8 mx $_domain +short)
      if [ -z "$mx_records" ]; then
          echo "MX records are missing for $_domain!"
      else
          echo "-----MX Records-----"
          echo "$mx_records"
          echo "-----A Records-----"
          echo "$(dig @8.8.8.8 $(dig @8.8.8.8 mx $_domain +short) +short)"
      fi

      # Check for SPF record
      spf_record=$(dig @8.8.8.8 txt $_domain +short)
      if [ -z "$spf_record" ]; then
          echo "SPF record is missing for $_domain!"
      else
          echo "-----SPF-----"
          echo "$spf_record"
      fi

      # Check for DKIM record
      dkim_record=$(dig @8.8.8.8 txt default._domainkey.$_domain +short)
      if [ -z "$dkim_record" ]; then
          echo "DKIM record is missing for $_domain!"
      else
          echo "-----DKIM-----"
          echo "$dkim_record"
      }

      # Check for DMARC record
      dmarc_record=$(dig @8.8.8.8 txt _dmarc.$_domain +short)
      if [ -z "$dmarc_record" ]; then
          echo "DMARC record is missing for $_domain!"
      else
          echo "-----DMARC-----"
          echo "$dmarc_record"
      }
    }

    # Call the function to check DNS records
    check_dns_records

    # Check if site is using Local Mail Delivery (LMD)
    grep $_domain /var/qmail/control/virtualdomains | wc -l | {
        read count
        if [ $count -eq 1 ]; then
            echo "The domain is using Local Mail Delivery!"
        else
            echo "The domain is not using Local Mail Delivery!"
        fi
    }

  } > $output_file 2>&1 

  # Print a notification in the terminal
  echo "Output redirected to: $output_file" > /dev/tty
}




