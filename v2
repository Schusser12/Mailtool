mailtool() {
    domain=$1
    output_file="~/mailtool-$(date +%m-%d-%yT%H:%M).txt"

    # Define common variables
    dns_server="8.8.8.8"
    log_dir="/var/log"
    
    # Define a function to check DNS records
    check_dns_records() {
        echo "Checking DNS records for domain $domain..."
        
        # Check MX records
        mx_records=$(dig @$dns_server mx $domain +short)
        if [ -z "$mx_records" ]; then
            echo "MX records are missing for $domain!"
        else
            echo "-----MX Records-----"
            echo "$mx_records"
            echo "-----A Records-----"
            echo "$(dig @$dns_server $(dig @$dns_server mx $domain +short) +short)"
        fi

        # Check SPF record
        spf_record=$(dig @$dns_server txt $domain +short)
        if [ -z "$spf_record" ]; then
            echo "SPF record is missing for $domain!"
        else
            echo "-----SPF Record-----"
            echo "$spf_record"
        fi

        # Check DKIM record
        dkim_record=$(dig @$dns_server txt default._domainkey.$domain +short)
        if [ -z "$dkim_record" ]; then
            echo "DKIM record is missing for $domain!"
        else
            echo "-----DKIM Record-----"
            echo "$dkim_record"
        fi

        # Check DMARC record
        dmarc_record=$(dig @$dns_server txt _dmarc.$domain +short)
        if [ -z "$dmarc_record" ]; then
            echo "DMARC record is missing for $domain!"
        else
            echo "-----DMARC Record-----"
            echo "$dmarc_record"
        fi
    }

    # Call the function to check DNS records
    check_dns_records

    # Check for Local Mail Delivery (LMD)
    grep $domain /var/qmail/control/virtualdomains | wc -l | {
        read count
        if [ $count -eq 1 ]; then
            echo "The domain is using Local Mail Delivery!"
        else
            echo "The domain is not using Local Mail Delivery!"
        fi
    }

    # Log search for outbound messages from 'ON-SERVER' scripts
    echo "Latest outbound messages from 'ON-SERVER' scripts:"
    cat $log_dir/send/* 2>/dev/null | tai64nlocal | grep $domain | tail -30

    # Log search for outbound SMTP2 messages
    echo "Outbound SMTP - mail generated by plugins/modules that utilize Nexcess's SMTP connection:"
    cat $log_dir/smtp2/current 2>/dev/null | tai64nlocal | grep $domain | tail -30

    # Log search for inbound messages
    echo "Inbound messages - 'I didn't get X, why?.. or did I?' check:"
    cat $log_dir/smtp/current 2>/dev/null | tai64nlocal | grep $domain | tail -30

    # Redirect the function output to a file
    } > $output_file

    # Print a notification in the terminal
    echo "Output redirected to: $output_file" > /dev/tty
}